---
title: "Introduction au langage de programmation R"
output: 
    html_document:
        toc: yes
        toc_float: yes
---

<style>
body {
text-align: justify}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, message = FALSE, warning = FALSE, collapse = TRUE,  fig.show = "hold", out.width = "100%", fig.align='center')
```

```{r klippy, echo=FALSE, include=TRUE}
klippy::klippy(position = c('top', 'right'), color = '#333333', tooltip_message = 'Click to copy')
```

<br> 

Cette formation a pour but de rendre **accessible à tous** la programmation en R. Pour cela, nous introduirons la notion de programmation dans un contexte général, puis nous nous pencherons sur le langage R en partant d'une vue globale pour entrer petit à petit dans les manipulations techniques. 

```{r icon-style, include=FALSE}
#remotes::install_github("mitchelloharawild/icons")
library(icons)
```

<br>

---

# `r icon_style(fontawesome("code", style = NULL), fill = "#0000CC")` <FONT COLOR="#0000CC">La programmation</FONT>

<br>

* **Qu'est-ce que la programmation ?**

Comme nous l'informe *Wikipédia*, la programmation - aussi appelée **codage** ou **développement**, désigne l'ensemble des activités qui permettent l'écriture de programmes informatiques. Cette écriture de programmes se fait dans un **langage de programmation**, les 10 principaux langages sont les suivants : HTML/CSS, JavaScript, PHP, Ruby, Java, Swift, C#, C ou C++, Python, Julia et Scala. **R** est aussi un langage de programmation qui est, lui, davantage axé sur l'**analyse statistique**.

<br>

* **Pourquoi la programmation ?**

La troisième révolution industrielle, connue sous le nom de "révolution informatique" s'accompagne d'une création de 2.5 trillions d'octets de données chaque jour. C'est dans ce contexte d'**abondance des données** qu'est née la science des données, visant à obtenir des informations et des connaissances à partir des données qui génèrent de la valeur. Le schéma ci-dessous peut aider à comprendre **comment** exploiter la valeur des données :

```{r echo=FALSE, out.width='52%', fig.align='center'}
knitr::include_graphics(here::here("images/cycle_data.png"))
```

<br>

---

# `r icon_style(fontawesome("eye", style = NULL), fill = "#0000CC")` <FONT COLOR="#0000CC">Vue globale du langage R</FONT>

<br>

* **Qu'est-ce que R ?**

Comme dit précédemment R est un **langage de programmation** en libre accès créé en 1993, destiné aux statistiques et à la science des données.

<br>

* **Pourquoi R ?**

```{r echo=FALSE, out.width='52%', fig.align='center'}
knitr::include_graphics(here::here("images/r_cars.jfif"))
```

Gratuit, facile d'accès, puissant, reproductible, design, le langage R est à la fois pertinent pour analyser les données, les visualiser et générer des rapports qui permettent - comme celui-ci, de mélanger du code, du texte et des graphiques. 

<br>

* **Comment coder en R ?**

Pour coder en R on utilise généralement l'interface **R studio** qui permet d'interagir avec le langage R de manière *aisée.* Quoi qu'il en soit, l'image partagée par Sylvain montre que la programmation est un apprentissage infini :

```{r echo=FALSE, out.width='30%', fig.align='center'}
knitr::include_graphics(here::here("images/using_r.jpeg"))
```

<br>

* **Installer R sur sa machine**

Pour installer l'interface RStudio il faut dans un premier temps **installer R** et dans un second temps **télécharger l'application RStudio**. Les liens de téléchargements sont disponibles sur le site [rstudio.com](https://www.rstudio.com/products/rstudio/download/#download). 

<br>

* **Configurer R**

Une fois l'installation terminée, il est important de configurer RStudio pour faciliter le travail sur l'interface et les partages de documents. Les paramètres généraux se trouvent dans le menu : *Tools > Global Options*

Vous pouvez configurer le '*General*' et le '*Code*' de la manière suivante :


```{r echo=FALSE, out.width='90%', fig.align='center', fig.asp=0.55}
library(cowplot)
library(ggplot2)

p1 <- ggdraw() + draw_image("images/options_R.png", scale = 0.9)
p2 <- ggdraw() + draw_image("images/options2_R.png", scale = 0.9)

plot_grid(p1, p2)
```


Il est aussi important de configurer la **sauvegarde** des scripts ; il faut spécifier un codage "UTF-8" pour que les caractères spéciaux de chaque script enregistré soient traités correctement, et ainsi faciliter le partage de codes. Cette option est disponible dans la fenêtre des *Global Options > Code > Saving > Default text encoding > Change... > UTF-8*. Enfin, dans cette même fenêtre des options générales de RStudio - dans l'option "***Appearance***", vous pouvez personnaliser l'apparence de votre interface en modifiant la police, la taille du texte, le thème etc.

```{r echo=FALSE, out.width='90%', fig.align='center', fig.asp=0.55}
p1 <- ggdraw() + draw_image("images/options3_R.png", scale = 0.9)
p2 <- ggdraw() + draw_image("images/options4_R.png", scale = 0.9)
plot_grid(p1, p2)
```

Ne pas oublier d'appliquer ces changements ('*Apply*') avant de fermer la fenêtre des options ('*Ok*').

<br>

* **Décomposition d'une fenêtre R**

Une fenêtre R à son ouverture est décomposée en 3 parties, 4 en diminuant la taille de la partie inférieure en cliquant sur le bouton `r icon_style(fontawesome("window-restore", style = NULL), fill = "#666666")` (ou via le menu : *View > Panes > Show all panes*). La programmation à proprement parler se fait dans la partie supérieure gauche, c'est là où on écrit les scripts que l'on pourra ensuite sauvegarder. 

NB : il est aussi possible de coder directement dans la console (partie inférieure gauche), la commande sera exécutée mais ne sera pas sauvegardée ; ça peut donc être intéressant pour exécuter une commande de manière instantanée (un calcul par exemple).

```{r echo=FALSE, out.width='80%', fig.align='center', strip.white=TRUE}
knitr::include_graphics(here::here("images/demarrage_R.png"))
```

\vspace{-3cm}

La partie inférieure droite est décomposée en 5 onglets :

* **Files** : les fichiers de l'ordinateur
* **Plots** : les graphiques créés apparaîtront ici
* **Packages** : liste de tous les *packages* installés sur la machine (nous reviendrons sur la notion plus tard)
* **Help** : onglet où l'on trouve toute l'aide nécessaire sur l'utilisation des fonctions
* **Viewer** : les objets interactifs créés (graphiques, cartes, tableaux) apparaîtront ici

<br>

* **L'environnement R**

Un avantage incontournable de R est la **communauté** qui existe autour pour trouver des ressources, de l'aide, de l'inspiration etc. On trouve notamment [R-bloggers](https://www.r-bloggers.com/) avec des nouveautés et des tutoriels écrits par des utilisateurs du langage, [RStudio Community](https://community.rstudio.com/) pour trouver/donner de l'aide (comme un *#TeamOpenData* de RStudio), [Stack Overflow](https://stackoverflow.com/) où l'on trouve la majorité des réponses aux questions de programmation - la plateforme n'est cependant pas propre à R. 

Il est aussi possible de relier RStudio à **Git**, ce qui permet de déposer du code, des bases de données et des objets créés (graphiques, cartes, documents html..) sur [github](https://github.com/). Les fichiers sont ainsi centralisés et sauvegardés sur un *repository* qui permet de collaborer facilement sur un projet. 

<br>


* **Le lexique de R**

<FONT COLOR="#CC0000">coder</FONT> = programmer

<FONT COLOR="#CC0000">ligne de commande</FONT> = ligne de code

<FONT COLOR="#CC0000">runer</FONT> = exécuter une commande (bouton '*Run*')

<FONT COLOR="#CC0000">package</FONT> = ensemble de fonctions

<FONT COLOR="#CC0000">library</FONT> = endroit où sont gardés les packages

<FONT COLOR="#CC0000">working directory</FONT> = répertoire de travail

<br>

* **Les types de documents pour travailler avec R**

Les principaux documents que l'on peut créer à partir de l'interface RStudio sont les suivants :

* **R Script**, extension *".R"* **:** document le plus basique où l'on peut (seulement) écrire du code et l'exécuter - très fonctionnel
* **R Markdown**, extension *".Rmd"* **:** document où l'on peut combiner du texte, du code, des graphiques et des tableaux de manière esthétique, comme celui-ci
* **Shiny web app**, extension *".R"* **:** application interactive où l'on peut assembler des visualisations et des tableaux

Pour créer un nouveau document il faut aller dans le menu : *File > New File > choisir celui que vous voulez créer*, ou sur le `r icon_style(fontawesome("plus-circle", style = NULL), fill = "#009900")` juste en dessous du '*File*' dans la barre de menu.

<br>

* **Travailler avec des projets R**

Ces documents peuvent être créés/ouverts **seuls** ou dans un **projet** : ![](images/r_project.png){width=3%}. Un *Rproject* est utile dès lors que l'on travaille sur une analyse avec de nombreux fichiers (données, scripts, images...) et en collaboration avec d'autres personnes. Il est effectivement possible d'organiser son espace de travail à partir de l'objet '***.Rproj***' :

* celui-ci se trouve dans un dossier où l'on **centralise tous les fichiers** nécessaires à l'analyse 
* depuis l'emplacement où se trouve le projet on peut créer des **sous-dossiers** pour organiser le travail
* en ouvrant dans RStudio le projet, les fichiers créés autour de celui-ci apparaissent dans la **partie inférieure droite de la fenêtre de RStudio**, ils sont donc accessibles facilement comme nous le voyons ici

<center>

![*Organisation du travail dans le dossier de la machine*](images/orga_travail_r_proj.png){width=60%}

</center>

<center>

![*Ouverture du projet sous RStudio, accès facilité aux fichiers*](images/rproj_RStudio.png){width=60%}

</center>

<br>

* il est alors possible d'appeler toute sorte d'objets (images, bases de données) en utilisant un **chemin relatif** et non un chemin global. Pour importer des données par exemple, le chemin global serait le suivant :

<center>

`data <- read_csv("C:/Users/name/desktop/mon_projet/data/base.csv")`

</center>

La limite de cette méthode apparaît quand on veut **partager** le code à quelqu'un d'autre qui n'aura pas le même chemin d'accès (ne serait-ce que pour le *nom d'utilisateur*). En travaillant dans un projet R, les chemins d'accès aux documents seront **relatifs** puisqu'ils débutent à l'endroit où l'on travaille (working directory), c'est-à-dire à l'emplacement du *.Rproj*. La commande pour importer les données avec le **chemin relatif** serait la suivante :

<center>

`data <- read_csv("./data/base.csv")`

</center>

Le point "**.**" correspond au répertoire de travail c'est-à-dire à l'emplacement du *RProject* ici. Le dossier avec le projet R peut être déplacé et partagé, l'import continuera de fonctionner grâce au chemin relatif. 

Pour créer un nouveau projet il faut aller dans le menu : *File > New Project > New Directory > New Project > entrer un nom de projet, éventuellement changer l'espace de travail > Create Project*, ou à partir du `r icon_style(fontawesome("plus-circle", style = NULL), fill = "#009900")` juste en dessous du '*Edit*' dans la barre de menu.

<br>

<style>
div.blue { background-color:#efefef; border-radius: 5px; padding: 20px;}
</style>
<div class = "blue">

 `r icon_style(fontawesome("thumbs-up", style = "solid"), fill = "#666666")`  <FONT COLOR="#333333">**Bonne pratique**

Un bon réflexe à prendre dès le début de votre carrière de programmeur est de ne laisser **aucun espace blanc** dans les noms des fichiers/dossiers, de manière à ce qu'ils puissent être lus à la fois par des personnes mais aussi par des machines. Les bons séparateurs des mots sont alors `-`ou `_`. Il est aussi recommandé de ne **pas mettre d'accent**, pour prévenir d'éventuels problèmes d'encodage. 

*Exemple de **mauvais nom** :* `Extraction des données de data.gouv.R`

*Exemple de **bon nom** :* `Extraction_donnees_data-gouv.R`</FONT>

</div>

<br>

---

# `r icon_style(fontawesome("search", style = NULL), fill = "#0000CC")` <FONT COLOR="#0000CC">Science et analyse des données avec R</FONT>

<br>


Maintenant que la notion de programmation est plus claire et que vous connaissez les rouages du langage R, nous allons entrer dans le vif du sujet en apprenant à manier les données ; que ce soit la mise en forme, l'analyse ou la visualisation. Cette partie reprendra étape par étape le schéma d'exploitation des données que nous avons vu en première partie :

```{r echo=FALSE, out.width='52%', fig.align='center'}
knitr::include_graphics(here::here("images/cycle_data.png"))
```

<br>

* **Deux manières de coder en R**

Avant de nous pencher sur l'import de données, voyons les deux manières de coder en R : le R-base et le tidyverse. La programmation dans le langage R a été révolutionnée ces dernières années par le statisticien *Hadley Wickham* et son équipe, qui ont développé le **tidyverse**. Contraction de *tidy* et *universe*, le tidyverse est une collection de packages R qui ont tous la même structure, simplifiant ainsi leur utilisation pour la data science. 


<div class="row">
<div class="col-md-2">
![](images/pipe_magritte.png){width=120%}
</div>
<div class="col-md-10">

<br>

Le tidyverse fonctionne grâce au **pipe** (%>%) contenu dans le package `magrittr`, qui permet d'appliquer un certain nombre de fonctions à une base de données. Le code est alors plus lisible grâce à une structuration des séquences d'opérations de **gauche à droite** (et non de l'extérieur à l'intérieur comme en R-base), qui permet d'**ajouter des étapes** n'importe où dans les séquences d'opérations. 
</div>
</div>


Un exemple de code en R-base et en tidyverse : 

* **R-base** : `h(g(f(x)))`
* **tidyverse** : `x %>% f %>% g %>% h`

Nous apprendrons à coder seulement en tidyverse dont l'approche est beaucoup plus simple pour débuter la programmation. 

<br>

* **Coder sous R : les bases**

Pour **exécuter** du code il faut placer son curseur sur la ligne de commande, puis cliquer sur le bouton ![](images/button_run.png){width=5.7%} en haut de la fenêtre, ou appuyer sur les touches *Ctrl-Enter*. Pour exécuter plusieurs lignes de code simultanément il suffit de les **sélectionner** avant de les *runer*. vous pouvez notamment vous entraîner en *runant* de simples opérations arithmétiques : 

```{r}
13+4
5*2
13+4-5*2
```


Il est possible d'*assigner** une valeur à un objet (dataframe, liste, vecteur, fonctions...) avec `<-` ou `=`, de manière à les **sauvegarder** dans l'environnement de travail (partie en haut à droite de la fenêtre RStudio). Vous pouvez par exemple *runer* les commandes suivantes :

```{r}
x <- 13+4
y <- 5*2
resultat = x-y
resultat
```


De cette manière, le code sous R se lit de droite à gauche ; 

* **à droite** on trouve la valeur 
* **à gauche** on trouve l'objet créé


<br>

* **Installation des packages fondamentaux**

Comme dit précédemment, un *package* contient un certain nombre de **fonctions** qui permettent de faire toutes sortes de manipulations sur des bases de données ou autres. Le *repository* officiel où sont stockés tous les packages R est appelé **CRAN** ; "the Comprehensive R Archive Network". Pour installer un package depuis le CRAN il faut utiliser la fonction `install.packages("nom_package")`. Mais il existe d'autres dépôts des packages créés, tel que Git (GitHub, GitLab, Bitbucket...) ; pour installer un package stocké sur *github* par exemple il faut utiliser la fonction `install_github("user_name/package_name")`, elle-même contenue dans le package **devtools**.


Pour utiliser un package, après l'avoir installé, il faut l'appeler via la fonction `library(nom_package)`. Le code ci-dessous permet d'installer les packages fondamentaux, il faut le copier, le coller dans un script R basique (*File > New File > R Script*) puis l'exécuter. 


*Plusieurs packages sont attachés au "tidyverse" :* 

* **ggplot2** : *pour visualiser les données*
* **tibble** : *pour traiter les données de type 'tibble'*
* **tidyr** : *pour nettoyer les données*
* **readr** : *pour importer des données CSV, TSV ou FWL*
* **purrr** : *pour itérer des fonctions*
* **dplyr** : *pour manipuler les donnée*
* **stringr** : *pour travailler avec des chaînes de caractères*
* **forcats** : *pour travailler avec des variables catégorielles*


```{r  eval=F, echo=T}
packages <- c("tidyverse", "remotes", "devtools", "rmarkdown", "rio")
install.packages(packages)
```

<br>

### Importer les données


* **Deux manières d'importer des données en R**

Il est possible d'importer des données dans l'environnement RStudio de deux manières : par un **fichier exporté** présent sur notre machine, ou directement via un **lien** qui pointe vers le téléchargement de ce fichier en ligne. Voici quelques exemples de plates-formes où il est possible d'en importer les données sans besoin préalable d'exporter le fichier :


+bonne pratique : via lien vpour reproductibilité des scirpts, n'implique pas manips exterieure

* **Les différents types de base de données**

Il existe un certain nombre de formats de jeux de données, nous allons lister les plus courants en précisant la commande qui permet de les lire sous R et importer les données correctement.



aide sur fonction : Fn+F1
via fichier en dur, via lien (astuces clique droit, copier le lien)
csv, excel, zip, sata, sas, xml, json etc.
scrapping, API

Si vous avez un doute pour importer vos données, vous pouvez le faire en presse-bouton via le menu : *File > Import Dataset > From ...*

* **From Text (base)** : 
* **From Text (readr)** : 
* **From Excel** : 
* **From SPSS** : 
* **From SAS** : 
* **From Stata** : 

<br>


### Nettoyer les données


* **Les différents types de données**

- nombre de NA (NC, N..), les supprimer, les remplacer (moyenne, mode...)
- observer les données : summary, moyenne, données, occurences avec table()
- différents types de données, voir avec str(), changer avec as.
- dire format tidy data : 1 ligne = 1 pays, individus, collectivité etc et 1 colonne = 1 varibale
- extraire carac d'une chaîne de caractères
- renommer les variables
- définir un indice

<br>



### Transformer les données

- ajout / suppression de colonnes
- jointures
- créer variables comme moyenne, médiane..
- fonctions principales du tidyverse : select, arrange, filter, mutate, group_by


<br>


### Visualiser les données

<br>


### Communiquer


<br>




<br>

---

# `r icon_style(fontawesome("book", style = NULL), fill = "#0000CC")` <FONT COLOR="#0000CC">Bibliographie</FONT>




























